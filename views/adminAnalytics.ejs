<%
var bodyContent = `
<style>
    .chart-container {
        position: relative;
        height: 300px;
        margin: 1rem 0;
    }
    .metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 0;
    }
    .metric-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin: 0;
    }
    .trend-indicator {
        font-size: 0.8rem;
        margin-left: 0.5rem;
    }
    .trend-up { color: #28a745; }
    .trend-down { color: #dc3545; }
    .trend-stable { color: #ffc107; }
    .real-time-badge {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
    }
    .status-online { background-color: #28a745; }
    .status-offline { background-color: #dc3545; }
    .status-unknown { background-color: #6c757d; }
</style>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Advanced Analytics Dashboard</h2>
                    </div>
                    <div>
                        <span class="badge bg-success real-time-badge">
                            <i class="bi bi-circle-fill me-1"></i>Real-time
                        </span>
                        <small class="text-muted ms-2">Last updated: ${new Date(lastUpdated).toLocaleString('id-ID')}</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overview Cards (match dashboard style) -->
        <div class="row widget-row">
            <div class="col-md-3 mb-3">
                <div class="widget-card genieacs-total">
                    <div>
                        <i class="bi bi-hdd-network widget-icon"></i>
                        <div class="widget-label">Total Devices</div>
                    </div>
                    <div>
                        <div class="widget-value">${typeof genieacs !== 'undefined' ? genieacs.total : 0}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="widget-card genieacs-online">
                    <div>
                        <i class="bi bi-wifi widget-icon"></i>
                        <div class="widget-label">Online Devices</div>
                    </div>
                    <div>
                        <div class="widget-value">${typeof genieacs !== 'undefined' ? genieacs.online : 0}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="widget-card pppoe-active">
                    <div>
                        <i class="bi bi-router widget-icon"></i>
                        <div class="widget-label">Active PPPoE</div>
                    </div>
                    <div>
                        <div class="widget-value">${typeof mikrotik !== 'undefined' ? mikrotik.active : 0}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="widget-card billing-revenue">
                    <div>
                        <i class="bi bi-cash-coin widget-icon"></i>
                        <div class="widget-label">Total Revenue</div>
                    </div>
                    <div>
                        <div class="widget-value">Rp ${(typeof billing !== 'undefined' && billing.invoices) ? billing.invoices.totalAmount.toLocaleString('id-ID') : '0'}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Statistics -->
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cogs me-2"></i>Device Manufacturers</h5>
                    </div>
                    <div class="card-body">
`;

Object.entries(genieacs.byManufacturer).forEach(([manufacturer, count]) => {
    bodyContent += `
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>${manufacturer}</span>
                            <span class="badge bg-primary">${count}</span>
                        </div>
`;
});

bodyContent += `
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-users me-2"></i>Customer Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span><span class="status-indicator status-online"></span>Active</span>
                            <span class="badge bg-success">${billing.customers.active}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span><span class="status-indicator status-offline"></span>Inactive</span>
                            <span class="badge bg-secondary">${billing.customers.inactive}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span><span class="status-indicator status-unknown"></span>Isolir</span>
                            <span class="badge bg-danger">${billing.customers.isolir}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-file-invoice me-2"></i>Invoice Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Pending</span>
                            <span class="badge bg-warning">${billing.invoices.pending}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Paid</span>
                            <span class="badge bg-success">${billing.invoices.paid}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Overdue</span>
                            <span class="badge bg-danger">${billing.invoices.overdue}</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between align-items-center">
                            <strong>Pending Amount</strong>
                            <strong class="text-warning">Rp ${billing.invoices.pendingAmount.toLocaleString('id-ID')}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real-time updates setiap 30 detik
        setInterval(async () => {
            try {
                const response = await fetch('/admin/analytics/api/real-time');
                const data = await response.json();
                
                if (data.success) {
                    // Update real-time data di halaman
                    console.log('Real-time data updated:', data.data);
                }
            } catch (error) {
                console.error('Error updating real-time data:', error);
            }
        }, 30000);
    </script>
`;
%>
<%- include('layouts/adminLayout', {body: bodyContent}) %>
