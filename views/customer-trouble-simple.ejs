<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Laporan Gangguan Sederhana</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .result-box { 
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
        }
        .form-label { 
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        .btn-outline-secondary {
            border-radius: 10px;
            padding: 10px 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-outline-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.2);
        }
        h2 {
            color: #343a40;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div class="container" style="max-width: 500px;">
        <h2 class="mb-4">Form Laporan Gangguan Sederhana</h2>
        <form id="simpleTroubleForm">
            <div class="mb-3">
                <label class="form-label">Nama</label>
                <input type="text" class="form-control" id="name" name="name" value="" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Nomor HP</label>
                <input type="text" class="form-control" id="phone" name="phone" value="" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Lokasi</label>
                <input type="text" class="form-control" id="location" name="location" value="" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Kategori Masalah</label>
                <select class="form-select" id="category" name="category" required>
                    <option value="">Pilih kategori</option>
                    <option value="Internet Lambat">Internet Lambat</option>
                    <option value="Tidak Bisa Browsing">Tidak Bisa Browsing</option>
                    <option value="WiFi Tidak Muncul">WiFi Tidak Muncul</option>
                    <option value="Koneksi Putus-Putus">Koneksi Putus-Putus</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Deskripsi Masalah</label>
                <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100">Kirim Laporan</button>
        </form>
        
        <!-- Back Section -->
        <div class="d-flex justify-content-center mt-4">
            <a href="/mobile-customer" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i>Kembali ke Dashboard
            </a>
        </div>
        
        <div id="resultBox" class="result-box d-none"></div>
        <div id="backBtnBox" class="d-none mt-3 text-center">
            <a href="/mobile-customer" class="btn btn-secondary">Kembali ke Dashboard</a>
        </div>
    </div>
    <script>
        const form = document.getElementById('simpleTroubleForm');
        const resultBox = document.getElementById('resultBox');
        const backBtnBox = document.getElementById('backBtnBox');
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            resultBox.classList.add('d-none');
            backBtnBox.classList.add('d-none');
            resultBox.innerHTML = '';
            const data = {
                name: form.name.value,
                phone: form.phone.value,
                location: form.location.value,
                category: form.category.value,
                description: form.description.value
            };
            if (!data.category || !data.description) {
                resultBox.innerHTML = '<div class="alert alert-warning">Kategori dan deskripsi wajib diisi.</div>';
                resultBox.classList.remove('d-none');
                backBtnBox.classList.remove('d-none');
                return;
            }
            // Coba POST ke /customer/trouble/report
            let response, json;
            try {
                response = await fetch('/customer/trouble/report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (response.headers.get('content-type')?.includes('application/json')) {
                    json = await response.json();
                } else {
                    throw new Error('Bukan JSON, kemungkinan session tidak valid');
                }
            } catch (err) {
                // Fallback ke GET /customer/trouble/test
                try {
                    const params = new URLSearchParams(data);
                    response = await fetch('/customer/trouble/test?' + params.toString());
                    json = await response.json();
                } catch (err2) {
                    resultBox.innerHTML = '<div class="alert alert-danger">Gagal mengirim laporan. Silakan coba lagi.</div>';
                    resultBox.classList.remove('d-none');
                    backBtnBox.classList.remove('d-none');
                    return;
                }
            }
            if (json && json.success) {
                resultBox.innerHTML = `<div class="alert alert-success">${json.message}<br><b>ID Tiket:</b> ${json.reportId}<br><small>Anda akan diarahkan ke dashboard dalam 3 detik...</small></div>`;
                setTimeout(() => { window.location.href = '/mobile-customer'; }, 3000);
            } else {
                resultBox.innerHTML = `<div class="alert alert-danger">${json && json.message ? json.message : 'Gagal mengirim laporan.'}</div>`;
            }
            resultBox.classList.remove('d-none');
            backBtnBox.classList.remove('d-none');
        });
    </script>
</body>
</html> 